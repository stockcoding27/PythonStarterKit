import pandas as pd

# ì£¼ì‹ ë°ì´í„° ìƒì„±
data = {
    "ì¢…ëª©ëª…": ["ì‚¼ì„±ì „ìž", "NAVER", "LGì—ë„ˆì§€ì†”ë£¨ì…˜", "ì¹´ì¹´ì˜¤", "í˜„ëŒ€ì°¨"],
    "ë³´ìœ ìˆ˜ëŸ‰": [120, 45, 30, 80, 50],
    "ìˆ˜ìµë¥ (%)": [12.5, -3.2, 7.8, -1.0, 5.4]
}

# ì¢…ëª©ì½”ë“œë¥¼ ì¸ë±ìŠ¤ë¡œ ì„¤ì •
index = ["005930", "035420", "373220", "035720", "005380"]
df = pd.DataFrame(data, index=index)

# ðŸ“Š ì „ì²´ DataFrame ì¶œë ¥
print("ðŸ“Š ì£¼ì‹ í¬íŠ¸í´ë¦¬ì˜¤:")
print(df.to_string())

# ðŸ” iat ë‹¨ì¼ ê°’ ì ‘ê·¼ ì˜ˆì‹œ
print(f"\nðŸ”¹ iat[2, 2] â†’ {df.iat[2, 2]}")

# ðŸ” at ë‹¨ì¼ ê°’ ì ‘ê·¼ ì˜ˆì‹œ
print(f"\nðŸ”¹ at['373220', 'ìˆ˜ìµë¥ (%)'] â†’ {df.at['373220', 'ìˆ˜ìµë¥ (%)']}")

# ðŸ” iloc ë²”ìœ„ ì˜ˆì‹œ: 1~3í–‰, 0~1ì—´ (í–‰ ì¸ë±ìŠ¤ 1~3, ì—´ ì¸ë±ìŠ¤ 0~1ê¹Œì§€)
print("\nðŸ”¹ iloc[1:4, 0:2] â†’")
print(df.iloc[1:4, 0:2])

# ðŸ” loc ë²”ìœ„ ì˜ˆì‹œ: ì¢…ëª©ì½”ë“œ "035420"ë¶€í„° "035720"ê¹Œì§€, "ì¢…ëª©ëª…"ê³¼ "ë³´ìœ ìˆ˜ëŸ‰"
print("\nðŸ”¹ loc['035420':'035720', ['ì¢…ëª©ëª…', 'ë³´ìœ ìˆ˜ëŸ‰']] â†’")
print(df.loc["035420":"035720", ["ì¢…ëª©ëª…", "ë³´ìœ ìˆ˜ëŸ‰"]])

# ðŸ”¹ ìƒˆë¡œìš´ ì¢…ëª© ì •ë³´ ì¶”ê°€ (SKí•˜ì´ë‹‰ìŠ¤ - ì¢…ëª©ì½”ë“œ: 000660)
df.loc["000660"] = {
    "ì¢…ëª©ëª…": "SKí•˜ì´ë‹‰ìŠ¤",
    "ë³´ìœ ìˆ˜ëŸ‰": 60,
    "ìˆ˜ìµë¥ (%)": 4.2
}

print(f"\nâœ… SKí•˜ì´ë‹‰ìŠ¤ ì¶”ê°€ í›„:")
print(df.to_string())

# ì‚¼ì„±ì „ìž drop
df.drop("005930", inplace=True)
print(f"\nâœ… ì‚¼ì„±ì „ìž drop í›„:")
print(df.to_string())


# .values í™œìš© ì˜ˆì œ
print("\nðŸ§© .values ì˜ˆì œ")
print("DataFrame.valuesì˜ íƒ€ìž…:", type(df.values))       # numpy.ndarray
print("DataFrame.valuesì˜ shape:", df.values.shape)      # (í–‰, ì—´)

# ê°œë³„ ì—´ì˜ .values (ë„˜íŒŒì´ ë°°ì—´)ê³¼ ìˆ˜ì¹˜ ì—°ì‚°
qty_values = df["ë³´ìœ ìˆ˜ëŸ‰"].values                       # np.ndarray
ret_values = df["ìˆ˜ìµë¥ (%)"].values                      # np.ndarray (float)

# ë„˜íŒŒì´ ë¸Œë¡œë“œìºìŠ¤íŒ…ìœ¼ë¡œ ê°„ë‹¨í•œ ì—°ì‚°: í‰ê°€ê¸ˆì•¡(ê°€ì •) = ë³´ìœ ìˆ˜ëŸ‰ * (1 + ìˆ˜ìµë¥ /100)
# ì‹¤ì œ ì‹œì„¸ê°€ ì—†ìœ¼ë‹ˆ, ìˆ˜ìµë¥ ë§Œìœ¼ë¡œ ê°€ìƒì˜ ê°€ì¤‘ì¹˜ ê³„ì‚° ì˜ˆì‹œ
weighted_qty = qty_values * (1 + ret_values / 100.0)
print("ë³´ìœ ìˆ˜ëŸ‰.values[:5] â†’", qty_values[:5])
print("ìˆ˜ìµë¥ .values[:5] â†’", ret_values[:5])
print("ê°€ì¤‘ ìˆ˜ëŸ‰(ì˜ˆì‹œ)[:5] â†’", weighted_qty[:5])

# .valuesë¥¼ ì´ìš©í•´ í–‰ë ¬ ì ‘ê·¼/ìŠ¬ë¼ì´ìŠ¤ë„ ê°€ëŠ¥(ë„˜íŒŒì´ ì¸ë±ì‹±)
arr = df.values
print("arr[0, :] (ì²« í–‰) â†’", arr[0, :])
print("arr[:, 1] (ë³´ìœ ìˆ˜ëŸ‰ ì—´) â†’", arr[:, 1])

# ================================
print("\nðŸŽ¯ ë§ˆìŠ¤í‚¹(masking) ì˜ˆì œ")

# 2-1) ìˆ˜ìµë¥ ì´ ì–‘ìˆ˜ì¸ ì¢…ëª©ë§Œ í•„í„°ë§
pos_mask = df["ìˆ˜ìµë¥ (%)"] > 0
print("ì–‘ìˆ˜ ìˆ˜ìµë¥  ë§ˆìŠ¤í¬:", pos_mask.values)
print("ì–‘ìˆ˜ ìˆ˜ìµë¥  ì¢…ëª©ë§Œ:")
print(df[pos_mask])

# 2-2) ë³µí•© ì¡°ê±´: ìˆ˜ìµë¥ >5 AND ë³´ìœ ìˆ˜ëŸ‰>=50
combo_mask = (df["ìˆ˜ìµë¥ (%)"] > 5) & (df["ë³´ìœ ìˆ˜ëŸ‰"] >= 50)
print("\nìˆ˜ìµë¥ >5 & ë³´ìœ ìˆ˜ëŸ‰â‰¥50 ì¡°ê±´ ì¢…ëª©:")
print(df[combo_mask])

# df ì €ìž¥
df.to_pickle("sample_df.pkl")

# df ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_pickle("sample_df.pkl")